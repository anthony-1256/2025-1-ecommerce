<div class="container mt-4">
    <h2 class="text-center mb-4">Carrito de compras</h2>

    <!-- cn: si no hay productos en el carrito -->
    <ng-container *ngIf="cart$ | async as cart">
        
        <div *ngIf="cart.items.length === 0" class="text-center py-20">
            <img
                src="https://cdn-icons-png.flaticon.com/512/2038/2038854.png"
                alt="Carrito vacÃ­o"
                class="mx-auto mb-4 w-24 h-24 opacity-60" />
            <p class="text-lg text-gray-500">Carrito vacÃ­o</p>
            <a class="text-blue-600 hover:underline text-sm mt-2 inline-block" style="font-size: 42px;" [routerLink]="['/productos']">
                Seguir comprando
            </a>
        </div>

        <div *ngIf="cart.items.length > 0" class="table-responsive">
            <table class="table table-bordered text-center align-middle">

                <thead class="table-light">
                    <tr>
                        <th>Imagen</th>
                        <th>Productos</th>
                        <th>Cantidad</th>
                        <th>Precio unitario</th>
                        <th>Total</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let item of cart.items; let i = index">
                        <td>
                            <img [src]="item.product.imgProduct"
                                alt="Producto"
                                width="60"
                                height="60"
                                class="rounded" />
                        </td>
                        <td>{{ item.product.productName }}</td>

                        <td class="d-flex justify-content-center align-items-center gap-2">
                            <button
                                class="btn btn-sm btn-outline-secondary"
                                (click)="decreaseQuantity(i)"
                                [disabled]="item.quantity <= 1">-</button>
                            <span class="px-2">H{{ item.quantity }}</span>
                            <button
                                class="btn btn-sm btn-outline-secondary"
                                (click)="increaseQuantity(item.product, i)"
                                [disabled]="item.quantity >= item.product.quantity">+</button>
                        </td>

                        <td>{{ item.product.price | currency }}</td>
                        <td> Total de producto: {{ item.quantity * item.product.price | currency }}</td>
                        <td>
                            <button
                                class="btn btn-sm btn-outline-danger"
                                (click)="removeItem(item.product)">ðŸ—‘</button>
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- Resumen y acciones -->
            <div class="text-end mt-3">
                <p><strong>Total a pagar: </strong>{{ totalPrice | currency }}</p>
            </div>
            
            <div class="d-flex justify-content-end gap-2 mt-2">
                <button class="btn btn-warning" (click)="manualClearCart()">Vaciar carrito</button>
                <button class="btn btn-success" (click)="goToCheckout()">Confirmar entrega</button>
            </div>
        </div>
    </ng-container>
</div>

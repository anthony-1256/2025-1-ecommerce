<!-- ***** src/app/pages/card-view/card-view.component.html ***** -->
<div class="container py-4">
    <div class="row justify-content-center">        
        <div class="col-12 col-lg-10">
            
            <!-- âœ… Loader global del producto -->
            <div *ngIf="isLoading" class="text-center my-5">
                <i class="fa-solid fa-spinner fa-spin fa-3x text-primary"></i>
                <p class="mt-2">Cargando producto...</p>
            </div>
            
            <!-- âœ… Contenido principal del producto -->
            <div *ngIf="!isLoading">
                
                <div
                    class="p-3 rounded"
                    style="margin: 15px 0; background-color: white; box-shadow: 0 8px 20px rgba(0,0,0,0.25);">
                    
                    <!-- Modal Header -->
                    <div class="mb-3">
                        <h2>{{ product.productName }}</h2>
                        <div class="d-flex gap-2 mt-2 flex-wrap">
                            <button class="btn btn-secondary" routerLink="/cards-group">Regresar</button>
                            <button class="btn btn-warning" routerLink="/favoritos">Favoritos</button>
                            <button class="btn btn-info" routerLink="/carrito">Carrito</button>
                        </div>
                    </div>
                    
                    <!-- Modal Body -->
                    <div class="row">
        
                        <!-- Columna izquierda: Imagen del producto -->
                        <div class="col-md-5 d-flex justify-content-center align-items-center position-relative">
        
                            <!-- Badge de descuento a la izquierda -->
                            <span
                                *ngIf="enrichedProduct.hasDiscount && enrichedProduct.lastPrice as lastPrice"
                                class="badge bg-danger position-absolute top-0 start-0 m-2 fs-5 p-2"
                                style="border: 2px solid white; box-shadow: 0 2px 6px rgba(0,0,0,0.3);">
                                -{{ ((lastPrice - enrichedProduct.product.price) / lastPrice * 100) | number:'1.0-0' }}%
                            </span>
        
                            <!-- CorazÃ³n de favoritos a la derecha -->
                            <button 
                                class="position-absolute top-0 end-0"
                                (click)="onToggleFavorite(product)"
                                [attr.aria-pressed]="isFavorite(product)"
                                [title]="isFavorite(product) ? 'Quitar de favoritos' : 'Agregar a favoritos'"
                                style="
                                    width: 48px; 
                                    height: 48px; 
                                    border-radius: 50%; 
                                    margin: 10px;
                                    background-color: rgba(255,255,255,0.95); 
                                    box-shadow: 0 4px 8px rgba(0,0,0,0.35); 
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    z-index: 10;
                                ">
                                <i class="fa-solid fa-heart"
                                [ngClass]="isFavorite(product) ? 'text-danger' : 'text-secondary'"
                                style="font-size: 22px;">
                                </i>
                            </button>
        
                            <!-- Imagen del producto con card sombra y margen -->
                            <img [src]="product.imgProduct" 
                                alt="{{ product.productName }}" 
                                class="img-fluid rounded"
                                style="
                                    max-height: 400px; 
                                    object-fit: contain; 
                                    box-shadow: 0 6px 12px rgba(0,0,0,0.2);
                                    margin: 10px;
                                ">
                        </div>
                        
                        <!-- Columna derecha: Detalles del producto -->
                        <div class="col-md-7">
                            <p class="mb-2"><strong>Marca:</strong> {{ product.brand.name }}</p>
                            <p class="mb-2"><strong>Modelo:</strong> {{ product.model }}</p>
                            <p class="mb-2"><strong>Categoria:</strong> {{ product.category }}</p>
                            <p class="mb-2"><strong>Capacidad:</strong> {{ product.capacity }}</p>
                            <p class="mb-2"><strong>Velocidad:</strong> {{ product.speed }}</p>
                            <p class="mb-2"><strong>DescripciÃ³n:</strong> {{ product.description }}</p>
                            
                            <!-- SecciÃ³n de unidades y precio -->
                            <div class="mt-3">
                                <!-- Disponibles y ajuste de cantidades en la misma lÃ­nea -->
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <!-- Stock disponible -->
                                    <small class="text-muted">Disponibles: {{ product.quantity }}</small>
                                    
                                    <!-- Botones de cantidad + span -->
                                    <div class="d-flex gap-2 align-items-center">
                                        <button
                                            (click)="decreaseQuantity(product)"
                                            class="btn btn-outline-secondary btn-sm rounded-circle"
                                            style="width: 32px; height: 32px;">-</button>
                                            <span class="px-2">{{ tempQuantities[product.idProduct] || 1 }}</span>
                                        <button
                                            (click)="increaseQuantity(product)"
                                            class="btn btn-outline-secondary btn-sm rounded-circle"
                                            style="width: 32px; height: 32px;">+</button>
                                    </div>
                                </div>
                                
                                <!-- IMPLEMENTACIÃ“N: Precio anterior producto principal -->
                                <p
                                    *ngIf="enrichedProduct.hasDiscount && enrichedProduct.lastPrice as lastPrice">
                                    Desde 
                                    <span class="text-decoration-line-through me-2 text-danger">
                                        {{ lastPrice | currency:'MXN' }}
                                    </span>
                                </p>
                                
                                <!-- card-view.component.html -->
                                <p class="card-text fw-bold mb-0" style="font-size: 16px; line-height: 1.1;">
                                    A tan solo:
                                    <small class="fw-bold text-success" style="font-size: 18px;">
                                        {{ product.price | currency:'MXN' }}
                                    </small>
                                </p>
                            
                                <!-- Total segÃºn cantidad temporal -->
                                <p
                                    class="card-text text-end mb-0 mt-0"
                                    style="font-size: 28px; line-height: 1.1;">
                                    <small class="text-muted">
                                        Total: {{ getTotal(product) | currency:'MXN' }}
                                    </small>
                                </p>
                            
                                <div class="d-flex justify-content-around mt-2 gap-2">
                                    <button 
                                        class="btn btn-warning d-flex align-items-center justify-content-center py-1"
                                        (click)="onBuyNow(product)"
                                        style="font-weight: 600; font-size: 12px; width: 150px;">
                                        âš¡ Compralo ahora
                                    </button>          
                                    <button 
                                        class="btn btn-success d-flex align-items-center justify-content-center py-1"
                                        (click)="onAddToCart(product)"
                                        title="Agregar al carrito"
                                        style="font-weight: 600; font-size: 12px; width: 150px;">
                                        ðŸ›’ Agregalo a tu carrito
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>                    
                </div>            

                <!-- SecciÃ³n inferior: Productos recomendados -->
                <div class="mt-5">
                    <h5>Productos recomendados</h5>

                    <div class="d-flex gap-3 flex-wrap">                        
                        <div class="card text-center position-relative"
                            style="
                                width: 12rem; 
                                cursor: pointer; 
                                margin: 10px; 
                                box-shadow: 0 6px 12px rgba(0,0,0,0.15);
                                border-radius: 10px;
                            "
                            *ngFor="let rec of recomendedProducts; let i = index"
                            (click)="goToProduct(rec.idProduct)">
                            
                            <!-- Badge de descuento a la izquierda -->
                            <span *ngIf="enrichedRecommendedProducts[i].hasDiscount && enrichedRecommendedProducts[i].lastPrice as lastPrice"
                                class="badge bg-danger position-absolute top-0 start-0 m-2 fs-6 p-1"
                                style="border: 1px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);">
                                -{{ ((lastPrice - enrichedRecommendedProducts[i].product.price) / lastPrice * 100) | number:'1.0-0' }}%
                            </span>

                            <!-- CorazÃ³n de favoritos a la derecha -->
                            <button 
                                class="position-absolute top-0 end-0"
                                (click)="onToggleFavorite(rec); $event.stopPropagation()"
                                [attr.aria-pressed]="isFavorite(rec)"
                                [title]="isFavorite(rec) ? 'Quitar de favoritos' : 'Agregar a favoritos'"
                                style="
                                    width: 36px;
                                    height: 36px;
                                    border-radius: 50%;
                                    margin: 6px;
                                    background-color: rgba(255,255,255,0.95);
                                    box-shadow: 0 4px 6px rgba(0,0,0,0.25);
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    z-index: 10;
                                ">
                                <i class="fa-solid fa-heart"
                                [ngClass]="isFavorite(rec) ? 'text-danger' : 'text-secondary'"
                                style="font-size: 18px;">
                                </i>
                            </button>

                            <!-- Imagen del producto -->
                            <img [src]="rec.imgProduct"
                                class="card-img-top rounded"
                                [alt]="rec.productName"
                                style="height: 120px; object-fit: contain; margin: 5px;">

                            <div class="card-body p-2">
                                <p class="card-text mb-1">{{ rec.productName }}</p>
                                <small class="text-muted">{{ rec.brand.name }}</small>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>